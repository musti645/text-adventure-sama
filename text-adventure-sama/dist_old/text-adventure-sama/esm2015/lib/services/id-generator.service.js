import { ItemYieldingAction } from '../models/actions/item-yielding-action.model';
import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
/**
 * Assigns IDs to Objects by counting the amount of distinct types
 */
export class IDGeneratorService {
    constructor() {
        this.typeArray = [];
    }
    generateIDs(game) {
        this.processScenes(game.getStage().getScenes());
        this.typeArray = [];
    }
    processScenes(scenes) {
        scenes.forEach(element => {
            if (!element.getID()) {
                element.setID(this.getIdFromTypeName(element.constructor.name));
            }
            else {
                this.setUsedIdForTypeName(element.constructor.name, element.getID());
            }
            this.processActions(element.getActions());
            this.processItems(element.getItems());
        });
    }
    processActions(actions) {
        actions.forEach(element => {
            if ((element instanceof ItemYieldingAction)
                && !element.getItem().getID()) {
                element.getItem().setID(this.getIdFromTypeName(element.constructor.name));
            }
        });
    }
    processItems(items) {
        items.forEach(element => {
            if (!element.getID()) {
                element.setID(this.getIdFromTypeName(element.constructor.name));
            }
            else {
                this.setUsedIdForTypeName(element.constructor.name, element.getID());
            }
        });
    }
    getIdFromTypeName(name) {
        const index = this.typeArray.findIndex(element => {
            return element.Name === name;
        });
        if (index !== -1) {
            return this.typeArray[index].getAndIncrementCount();
        }
        return this.createTypeCountContainer(name).getAndIncrementCount();
    }
    addItemId(item) {
        this.setUsedIdForTypeName(item.constructor.name, item.getID());
    }
    addSceneId(scene) {
        this.setUsedIdForTypeName(scene.constructor.name, scene.getID());
    }
    addActionItemId(action) {
        this.setUsedIdForTypeName(action.getItem().constructor.name, action.getItem().getID());
    }
    /**
     * Add the passed id to the corresponding typeNameContainer's usedID Array
     */
    setUsedIdForTypeName(name, id) {
        const index = this.typeArray.findIndex(element => {
            return element.Name === name;
        });
        if (index !== -1) {
            this.typeArray[index].addUsedID(id);
            return;
        }
        this.createTypeCountContainer(name).addUsedID(id);
    }
    createTypeCountContainer(name) {
        const container = new TypeCountContainer(name);
        this.typeArray.push(container);
        return container;
    }
    getTypeCountContainers() {
        return this.typeArray;
    }
}
IDGeneratorService.ɵprov = i0.ɵɵdefineInjectable({ factory: function IDGeneratorService_Factory() { return new IDGeneratorService(); }, token: IDGeneratorService, providedIn: "root" });
IDGeneratorService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
IDGeneratorService.ctorParameters = () => [];
export class TypeCountContainer {
    constructor(name) {
        this.Name = name;
        this.Count = 0;
        this.UsedIDs = [];
    }
    getAndIncrementCount() {
        this.Count++;
        while (this.isCurrentCountUsed()) {
            this.Count++;
        }
        this.addUsedID(this.Count);
        return this.Count;
    }
    addUsedID(usedId) {
        if (this.isIdUsed(usedId)) {
            throw new EvalError('Id is already being used.');
        }
        this.UsedIDs.push(usedId);
    }
    isCurrentCountUsed() {
        return this.UsedIDs.filter(element => element === this.Count).length > 0;
    }
    isIdUsed(id) {
        return !(!this.UsedIDs.find(element => element === id));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWQtZ2VuZXJhdG9yLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiRTovRG9rdW1lbnRlL1JlcG9zaXRvcmllcy9UZXh0QWR2ZW50dXJlU2FtYS90ZXh0LWFkdmVudHVyZS1zYW1hL3Byb2plY3RzL3RleHQtYWR2ZW50dXJlLXNhbWEvc3JjLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2lkLWdlbmVyYXRvci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7O0FBRTNDOztHQUVHO0FBSUgsTUFBTSxPQUFPLGtCQUFrQjtJQUczQjtRQUZRLGNBQVMsR0FBeUIsRUFBRSxDQUFDO0lBSTdDLENBQUM7SUFFTSxXQUFXLENBQUMsSUFBVTtRQUN6QixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFHUyxhQUFhLENBQUMsTUFBZTtRQUNuQyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUU7Z0JBQ2xCLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUNuRTtpQkFBTTtnQkFDSCxJQUFJLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7YUFDeEU7WUFFRCxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1lBQzFDLElBQUksQ0FB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QUFDO0lBQzdFLENBQUM7SUFFRCxRQUFRLENBQUMsRUFBVTtRQUNmLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHYW1lIH0gZnJvbSAnLi4vbW9kZWxzL2dhbWUubW9kZWwnO1xyXG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gJy4uL21vZGVscy9zY2VuZS5tb2RlbCc7XHJcbmltcG9ydCB7IEluR2FtZUl0ZW0gfSBmcm9tICcuLi9tb2RlbHMvSXRlbS5tb2RlbCc7XHJcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gJy4uL21vZGVscy9hY3Rpb25zL2FjdGlvbi5tb2RlbCc7XHJcbmltcG9ydCB7IEl0ZW1ZaWVsZGluZ0FjdGlvbiB9IGZyb20gJy4uL21vZGVscy9hY3Rpb25zL2l0ZW0teWllbGRpbmctYWN0aW9uLm1vZGVsJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuLyoqXHJcbiAqIEFzc2lnbnMgSURzIHRvIE9iamVjdHMgYnkgY291bnRpbmcgdGhlIGFtb3VudCBvZiBkaXN0aW5jdCB0eXBlc1xyXG4gKi9cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBJREdlbmVyYXRvclNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSB0eXBlQXJyYXk6IFR5cGVDb3VudENvbnRhaW5lcltdID0gW107XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZW5lcmF0ZUlEcyhnYW1lOiBHYW1lKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzU2NlbmVzKGdhbWUuZ2V0U3RhZ2UoKS5nZXRTY2VuZXMoKSk7XHJcbiAgICAgICAgdGhpcy50eXBlQXJyYXkgPSBbXTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJvdGVjdGVkIHByb2Nlc3NTY2VuZXMoc2NlbmVzOiBTY2VuZVtdKTogdm9pZCB7XHJcbiAgICAgICAgc2NlbmVzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZWxlbWVudC5nZXRJRCgpKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNldElEKHRoaXMuZ2V0SWRGcm9tVHlwZU5hbWUoZWxlbWVudC5jb25zdHJ1Y3Rvci5uYW1lKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZWRJZEZvclR5cGVOYW1lKGVsZW1lbnQuY29uc3RydWN0b3IubmFtZSwgZWxlbWVudC5nZXRJRCgpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzQWN0aW9ucyhlbGVtZW50LmdldEFjdGlvbnMoKSk7XHJcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0l0ZW1zKGVsZW1lbnQuZ2V0SXRlbXMoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIHByb2Nlc3NBY3Rpb25zKGFjdGlvbnM6IEFjdGlvbltdKTogdm9pZCB7XHJcbiAgICAgICAgYWN0aW9ucy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoKGVsZW1lbnQgaW5zdGFuY2VvZiBJdGVtWWllbGRpbmdBY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAmJiAhZWxlbWVudC5nZXRJdGVtKCkuZ2V0SUQoKSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5nZXRJdGVtKCkuc2V0SUQodGhpcy5nZXRJZEZyb21UeXBlTmFtZShlbGVtZW50LmNvbnN0cnVjdG9yLm5hbWUpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBwcm9jZXNzSXRlbXMoaXRlbXM6IEluR2FtZUl0ZW1bXSk6IHZvaWQge1xyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZWxlbWVudC5nZXRJRCgpKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNldElEKHRoaXMuZ2V0SWRGcm9tVHlwZU5hbWUoZWxlbWVudC5jb25zdHJ1Y3Rvci5uYW1lKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZWRJZEZvclR5cGVOYW1lKGVsZW1lbnQuY29uc3RydWN0b3IubmFtZSwgZWxlbWVudC5nZXRJRCgpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRJZEZyb21UeXBlTmFtZShuYW1lOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy50eXBlQXJyYXkuZmluZEluZGV4KGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudC5OYW1lID09PSBuYW1lO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnR5cGVBcnJheVtpbmRleF0uZ2V0QW5kSW5jcmVtZW50Q291bnQoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUeXBlQ291bnRDb250YWluZXIobmFtZSkuZ2V0QW5kSW5jcmVtZW50Q291bnQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkSXRlbUlkKGl0ZW06IEluR2FtZUl0ZW0pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldFVzZWRJZEZvclR5cGVOYW1lKGl0ZW0uY29uc3RydWN0b3IubmFtZSwgaXRlbS5nZXRJRCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkU2NlbmVJZChzY2VuZTogU2NlbmUpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldFVzZWRJZEZvclR5cGVOYW1lKHNjZW5lLmNvbnN0cnVjdG9yLm5hbWUsIHNjZW5lLmdldElEKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRBY3Rpb25JdGVtSWQoYWN0aW9uOiBJdGVtWWllbGRpbmdBY3Rpb24pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldFVzZWRJZEZvclR5cGVOYW1lKGFjdGlvbi5nZXRJdGVtKCkuY29uc3RydWN0b3IubmFtZSwgYWN0aW9uLmdldEl0ZW0oKS5nZXRJRCgpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZCB0aGUgcGFzc2VkIGlkIHRvIHRoZSBjb3JyZXNwb25kaW5nIHR5cGVOYW1lQ29udGFpbmVyJ3MgdXNlZElEIEFycmF5XHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBzZXRVc2VkSWRGb3JUeXBlTmFtZShuYW1lOiBzdHJpbmcsIGlkOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMudHlwZUFycmF5LmZpbmRJbmRleChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuTmFtZSA9PT0gbmFtZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLnR5cGVBcnJheVtpbmRleF0uYWRkVXNlZElEKGlkKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jcmVhdGVUeXBlQ291bnRDb250YWluZXIobmFtZSkuYWRkVXNlZElEKGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgY3JlYXRlVHlwZUNvdW50Q29udGFpbmVyKG5hbWU6IHN0cmluZyk6IFR5cGVDb3VudENvbnRhaW5lciB7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gbmV3IFR5cGVDb3VudENvbnRhaW5lcihuYW1lKTtcclxuICAgICAgICB0aGlzLnR5cGVBcnJheS5wdXNoKGNvbnRhaW5lcik7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0VHlwZUNvdW50Q29udGFpbmVycygpOiBUeXBlQ291bnRDb250YWluZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZUFycmF5O1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFR5cGVDb3VudENvbnRhaW5lciB7XHJcbiAgICBwdWJsaWMgTmFtZTogc3RyaW5nO1xyXG4gICAgcHVibGljIENvdW50OiBudW1iZXI7XHJcbiAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSB1c2VkIGlkcyBmb3IgZWFjaCB0eXBlXHJcbiAgICBwdWJsaWMgVXNlZElEczogbnVtYmVyW107XHJcblxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5OYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLkNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLlVzZWRJRHMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRBbmRJbmNyZW1lbnRDb3VudCgpOiBudW1iZXIge1xyXG4gICAgICAgIHRoaXMuQ291bnQrKztcclxuICAgICAgICB3aGlsZSAodGhpcy5pc0N1cnJlbnRDb3VudFVzZWQoKSkge1xyXG4gICAgICAgICAgICB0aGlzLkNvdW50Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWRkVXNlZElEKHRoaXMuQ291bnQpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLkNvdW50O1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFVzZWRJRCh1c2VkSWQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmlzSWRVc2VkKHVzZWRJZCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEV2YWxFcnJvcignSWQgaXMgYWxyZWFkeSBiZWluZyB1c2VkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLlVzZWRJRHMucHVzaCh1c2VkSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzQ3VycmVudENvdW50VXNlZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5Vc2VkSURzLmZpbHRlcihlbGVtZW50ID0+IGVsZW1lbnQgPT09IHRoaXMuQ291bnQpLmxlbmd0aCA+IDA7XHJcbiAgICB9XHJcblxyXG4gICAgaXNJZFVzZWQoaWQ6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhKCF0aGlzLlVzZWRJRHMuZmluZChlbGVtZW50ID0+IGVsZW1lbnQgPT09IGlkKSk7XHJcbiAgICB9XHJcbn1cclxuIl19