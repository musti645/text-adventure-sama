import { InGameItem } from '../models/Item.model';
import { BaseBuilder } from './base.builder';
import { BuilderError } from '../models/errors/builder.error';
export class ItemBuilder extends BaseBuilder {
    constructor(builder, item = new InGameItem(), requireInSceneDescription = false) {
        super();
        this.Item = item;
        this.Builder = builder;
        this.RequireInSceneDescription = requireInSceneDescription;
    }
    setName(name) {
        if (!name) {
            throw new EvalError('Name was undefined');
        }
        this.Item.setName(name);
        return this;
    }
    setDescription(description) {
        if (!description) {
            throw new EvalError('Description was undefined');
        }
        this.Item.setDescription(description);
        return this;
    }
    setMaximumUsages(maxUsages) {
        if (maxUsages === undefined || maxUsages <= 0) {
            throw new EvalError('MaximumUsages Value has to be greater than 0.');
        }
        if (this.Item.getUsagesLeft() && this.Item.getUsagesLeft() > maxUsages) {
            throw new EvalError('MaximumUsages Value has to be greater or equal to the UsagesLeft Value');
        }
        this.Item.setMaximumUsages(maxUsages);
        return this;
    }
    setUsagesLeft(usagesLeft) {
        if (usagesLeft === undefined || usagesLeft === null || usagesLeft < 0) {
            throw new EvalError('UsagesLeft Value has to be greater than or equal to 0.');
        }
        if (this.Item.getMaximumUsages() && usagesLeft > this.Item.getMaximumUsages()) {
            throw new EvalError('UsagesLeft Value has to be less or equal to the MaximumUsages Value.');
        }
        this.Item.setUsagesLeft(usagesLeft);
        return this;
    }
    setItemUsedResponse(response) {
        if (!response) {
            throw new EvalError('ItemUsedResponse was undefined.');
        }
        this.Item.setItemUsedResponse(response);
        return this;
    }
    setNoUsagesLeftResponse(response) {
        if (!response) {
            throw new EvalError('NoUsagesLeftResponse was undefined.');
        }
        this.Item.setNoUsagesLeftResponse(response);
        return this;
    }
    setCanPickUp(value) {
        this.Item.setCanPickUp(value);
        return this;
    }
    setCannotPickUpResponse(response) {
        if (!response) {
            throw new EvalError('CannotPickUpResponse was undefined.');
        }
        this.Item.setCannotPickUpResponse(response);
        return this;
    }
    setInSceneDescription(descr) {
        if (!descr) {
            throw new EvalError('InSceneDescription was undefined.');
        }
        this.Item.setInSceneDescription(descr);
        return this;
    }
    setCanUseFunction(func) {
        if (!func) {
            throw new EvalError('CanUseFunction was undefined.');
        }
        this.IsCanUseFunctionReplaced = true;
        this.Item.setCanUseFunction(func);
        return this;
    }
    setCannotUseItemResponse(response) {
        if (!response) {
            throw new EvalError('CannotUseItemResponse was undefined');
        }
        this.Item.setCannotUseItemResponse(response);
        return this;
    }
    finish() {
        if (!this.Item.getName()) {
            throw new BuilderError('Item creation could not be finished. Name was not set.');
        }
        if (!this.Item.getDescription()) {
            throw new BuilderError('Item creation could not be finished. Description was not set.');
        }
        if (this.Item.getUsagesLeft() > 0 && !this.Item.getItemUsedResponse()) {
            throw new BuilderError('Item creation could not be finished. ItemUsedResponse was not set.');
        }
        if (!this.Item.getNoUsagesLeftResponse()) {
            throw new BuilderError('Item creation could not be finished. NoUsagesLeftResponse was not set.');
        }
        if (!this.Item.getCanPickUp() && !this.Item.getCannotPickUpResponse()) {
            throw new BuilderError('Item creation could not be finished. CannotPickUpResponse was not set.');
        }
        // if this item is added to a scene, instead of the inventory or an action, the InSceneDescription has to be set.
        if (this.RequireInSceneDescription && !this.Item.getInSceneDescription()) {
            throw new BuilderError('Item creation could not be finished. InSceneDescription was not set.');
        }
        if (this.IsCanUseFunctionReplaced && !this.Item.getCannotUseItemResponse()) {
            throw new BuilderError('Item creation could not be finished. CannotUseItemResponse was not set.');
        }
        if (this.Item.getMaximumUsages() < 0) {
            this.Item.setMaximumUsages(1);
        }
        if (this.Item.getUsagesLeft() < 0) {
            this.Item.setUsagesLeft(1);
        }
        this.Builder.addItemToBuilder(this.Item);
        return this.Builder;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5idWlsZGVyLmpzIiwic291cmNlUm9vdCI6IkU6L0Rva3VtZW50ZS9SZXBvc2l0b3JpZXMvVGV4dEFkdmVudHVyZVNhbWEvdGV4dC1hZHZlbnR1cmUtc2FtYS9wcm9qZWN0cy90ZXh0LWFkdmVudHVyZS1zYW1hL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9idWlsZGVyL2l0ZW0uYnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUk5RCxNQUFNLE9BQU8sV0FBNkQsU0FBUSxXQUFXO0lBTXpGLFlBQVksT0FBMEIsRUFBRSxPQUFtQixJQUFJLFVBQVUsRUFBRSxFQUFFLDRCQUFxQyxLQUFLO1FBQ25ILEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLHlCQUF5QixHQUFHLHlCQUF5QixDQUFDO0lBQy9ELENBQUM7SUFFTSxPQUFPLENBQUMsSUFBWTtRQUN2QixJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsTUFBTSxJQUFJLFNBQVMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1NBQzdDO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVNLGNBQWMsQ0FBQyxXQUFtQjtRQUNyQyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2QsTUFBTSxJQUFJLFNBQVMsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1NBQ3BEO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUM7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RztRQUVELElBQUksSUFBSSxDQUFDLHdCQUF3QixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxFQUFFO1lBQ3hFLE1BQU0sSUFBSSxZQUFZLENBQUMseUVBQXlFLENBQUMsQ0FBQztTQUNyRztRQUVELElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLENBQUMsRUFBRTtZQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ2pDO1FBRUQsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsRUFBRTtZQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUM5QjtRQUVELElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN4QixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbkdhbWVJdGVtIH0gZnJvbSAnLi4vbW9kZWxzL0l0ZW0ubW9kZWwnO1xyXG5pbXBvcnQgeyBJdGVtQ29udGFpbmluZ0J1aWxkZXIgfSBmcm9tICcuL2ludGVyZmFjZXMvaXRlbS1jb250YWluaW5nLmJ1aWxkZXInO1xyXG5pbXBvcnQgeyBCYXNlQnVpbGRlciB9IGZyb20gJy4vYmFzZS5idWlsZGVyJztcclxuaW1wb3J0IHsgQnVpbGRlckVycm9yIH0gZnJvbSAnLi4vbW9kZWxzL2Vycm9ycy9idWlsZGVyLmVycm9yJztcclxuaW1wb3J0IHsgU2NlbmUgfSBmcm9tICcuLi9tb2RlbHMvc2NlbmUubW9kZWwnO1xyXG5pbXBvcnQgeyBJbnZlbnRvcnkgfSBmcm9tICcuLi9tb2RlbHMvaW52ZW50b3J5Lm1vZGVsJztcclxuXHJcbmV4cG9ydCBjbGFzcyBJdGVtQnVpbGRlcjxSZXR1cm5CdWlsZGVyVHlwZSBleHRlbmRzIEl0ZW1Db250YWluaW5nQnVpbGRlcj4gZXh0ZW5kcyBCYXNlQnVpbGRlciB7XHJcbiAgICBwcm90ZWN0ZWQgSXRlbTogSW5HYW1lSXRlbTtcclxuICAgIHByaXZhdGUgQnVpbGRlcjogUmV0dXJuQnVpbGRlclR5cGU7XHJcbiAgICBwcml2YXRlIFJlcXVpcmVJblNjZW5lRGVzY3JpcHRpb246IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIElzQ2FuVXNlRnVuY3Rpb25SZXBsYWNlZDogYm9vbGVhbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihidWlsZGVyOiBSZXR1cm5CdWlsZGVyVHlwZSwgaXRlbTogSW5HYW1lSXRlbSA9IG5ldyBJbkdhbWVJdGVtKCksIHJlcXVpcmVJblNjZW5lRGVzY3JpcHRpb246IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5JdGVtID0gaXRlbTtcclxuICAgICAgICB0aGlzLkJ1aWxkZXIgPSBidWlsZGVyO1xyXG4gICAgICAgIHRoaXMuUmVxdWlyZUluU2NlbmVEZXNjcmlwdGlvbiA9IHJlcXVpcmVJblNjZW5lRGVzY3JpcHRpb247XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldE5hbWUobmFtZTogc3RyaW5nKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFuYW1lKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFdmFsRXJyb3IoJ05hbWUgd2FzIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5JdGVtLnNldE5hbWUobmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldERlc2NyaXB0aW9uKGRlc2NyaXB0aW9uOiBzdHJpbmcpOiB0aGlzIHtcclxuICAgICAgICBpZiAoIWRlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFdmFsRXJyb3IoJ0Rlc2NyaXB0aW9uIHdhcyB1bmRlZmluZWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuSXRlbS5zZXREZXNjcmlwdGlvbihkZXNjcmlwdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldE1heGltdW1Vc2FnZXMobWF4VXNhZ2VzOiBudW1iZXIpOiB0aGlzIHtcclxuICAgICAgICBpZiAobWF4VXNhZ2VzID09PSB1bmRlZmluZWQgfHwgbWF4VXNhZ2VzIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEV2YWxFcnJvcignTWF4aW11bVVzYWdlcyBWYWx1ZSBoYXMgdG8gYmUgZ3JlYXRlciB0aGFuIDAuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5JdGVtLmdldFVzYWdlc0xlZnQoKSAmJiB0aGlzLkl0ZW0uZ2V0VXNhZ2VzTGVmdCgpID4gbWF4VXNhZ2VzKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFdmFsRXJyb3IoJ01heGltdW1Vc2FnZXMgVmFsdWUgaGFzIHRvIGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIFVzYWdlc0xlZnQgVmFsdWUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuSXRlbS5zZXRNYXhpbXVtVXNhZ2VzKG1heFVzYWdlcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFVzYWdlc0xlZnQodXNhZ2VzTGVmdDogbnVtYmVyKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKHVzYWdlc0xlZnQgPT09IHVuZGVmaW5lZCB8fCB1c2FnZXNMZWZ0ID09PSBudWxsIHx8IHVzYWdlc0xlZnQgPCAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFdmFsRXJyb3IoJ1VzYWdlc0xlZnQgVmFsdWUgaGFzIHRvIGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAwLicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuSXRlbS5nZXRNYXhpbXVtVXNhZ2VzKCkgJiYgdXNhZ2VzTGVmdCA+IHRoaXMuSXRlbS5nZXRNYXhpbXVtVXNhZ2VzKCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEV2YWxFcnJvcignVXNhZ2VzTGVmdCBWYWx1ZSBoYXMgdG8gYmUgbGVzcyBvciBlcXVhbCB0byB0aGUgTWF4aW11bVVzYWdlcyBWYWx1ZS4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuSXRlbS5zZXRVc2FnZXNMZWZ0KHVzYWdlc0xlZnQpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRJdGVtVXNlZFJlc3BvbnNlKHJlc3BvbnNlOiBzdHJpbmcpOiB0aGlzIHtcclxuICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFdmFsRXJyb3IoJ0l0ZW1Vc2VkUmVzcG9uc2Ugd2FzIHVuZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuSXRlbS5zZXRJdGVtVXNlZFJlc3BvbnNlKHJlc3BvbnNlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIHNldE5vVXNhZ2VzTGVmdFJlc3BvbnNlKHJlc3BvbnNlOiBzdHJpbmcpOiB0aGlzIHtcclxuICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFdmFsRXJyb3IoJ05vVXNhZ2VzTGVmdFJlc3BvbnNlIHdhcyB1bmRlZmluZWQuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLkl0ZW0uc2V0Tm9Vc2FnZXNMZWZ0UmVzcG9uc2UocmVzcG9uc2UpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRDYW5QaWNrVXAodmFsdWU6IGJvb2xlYW4pOiB0aGlzIHtcclxuICAgICAgICB0aGlzLkl0ZW0uc2V0Q2FuUGlja1VwKHZhbHVlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0Q2Fubm90UGlja1VwUmVzcG9uc2UocmVzcG9uc2U6IHN0cmluZyk6IHRoaXMge1xyXG4gICAgICAgIGlmICghcmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEV2YWxFcnJvcignQ2Fubm90UGlja1VwUmVzcG9uc2Ugd2FzIHVuZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuSXRlbS5zZXRDYW5ub3RQaWNrVXBSZXNwb25zZShyZXNwb25zZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEluU2NlbmVEZXNjcmlwdGlvbihkZXNjcjogc3RyaW5nKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFkZXNjcikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXZhbEVycm9yKCdJblNjZW5lRGVzY3JpcHRpb24gd2FzIHVuZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuSXRlbS5zZXRJblNjZW5lRGVzY3JpcHRpb24oZGVzY3IpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRDYW5Vc2VGdW5jdGlvbihmdW5jOiAoaXRlbTogSW5HYW1lSXRlbSwgY3VycmVudFNjZW5lOiBTY2VuZSwgaW52ZW50b3J5OiBJbnZlbnRvcnkpID0+IGJvb2xlYW4pOiB0aGlzIHtcclxuICAgICAgICBpZiAoIWZ1bmMpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEV2YWxFcnJvcignQ2FuVXNlRnVuY3Rpb24gd2FzIHVuZGVmaW5lZC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuSXNDYW5Vc2VGdW5jdGlvblJlcGxhY2VkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLkl0ZW0uc2V0Q2FuVXNlRnVuY3Rpb24oZnVuYyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldENhbm5vdFVzZUl0ZW1SZXNwb25zZShyZXNwb25zZTogc3RyaW5nKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXZhbEVycm9yKCdDYW5ub3RVc2VJdGVtUmVzcG9uc2Ugd2FzIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5JdGVtLnNldENhbm5vdFVzZUl0ZW1SZXNwb25zZShyZXNwb25zZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGZpbmlzaCgpOiBSZXR1cm5CdWlsZGVyVHlwZSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLkl0ZW0uZ2V0TmFtZSgpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBCdWlsZGVyRXJyb3IoJ0l0ZW0gY3JlYXRpb24gY291bGQgbm90IGJlIGZpbmlzaGVkLiBOYW1lIHdhcyBub3Qgc2V0LicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLkl0ZW0uZ2V0RGVzY3JpcHRpb24oKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgQnVpbGRlckVycm9yKCdJdGVtIGNyZWF0aW9uIGNvdWxkIG5vdCBiZSBmaW5pc2hlZC4gRGVzY3JpcHRpb24gd2FzIG5vdCBzZXQuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5JdGVtLmdldFVzYWdlc0xlZnQoKSA+IDAgJiYgIXRoaXMuSXRlbS5nZXRJdGVtVXNlZFJlc3BvbnNlKCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEJ1aWxkZXJFcnJvcignSXRlbSBjcmVhdGlvbiBjb3VsZCBub3QgYmUgZmluaXNoZWQuIEl0ZW1Vc2VkUmVzcG9uc2Ugd2FzIG5vdCBzZXQuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuSXRlbS5nZXROb1VzYWdlc0xlZnRSZXNwb25zZSgpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBCdWlsZGVyRXJyb3IoJ0l0ZW0gY3JlYXRpb24gY291bGQgbm90IGJlIGZpbmlzaGVkLiBOb1VzYWdlc0xlZnRSZXNwb25zZSB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5JdGVtLmdldENhblBpY2tVcCgpICYmICF0aGlzLkl0ZW0uZ2V0Q2Fubm90UGlja1VwUmVzcG9uc2UoKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgQnVpbGRlckVycm9yKCdJdGVtIGNyZWF0aW9uIGNvdWxkIG5vdCBiZSBmaW5pc2hlZC4gQ2Fubm90UGlja1VwUmVzcG9uc2Ugd2FzIG5vdCBzZXQuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpZiB0aGlzIGl0ZW0gaXMgYWRkZWQgdG8gYSBzY2VuZSwgaW5zdGVhZCBvZiB0aGUgaW52ZW50b3J5IG9yIGFuIGFjdGlvbiwgdGhlIEluU2NlbmVEZXNjcmlwdGlvbiBoYXMgdG8gYmUgc2V0LlxyXG4gICAgICAgIGlmICh0aGlzLlJlcXVpcmVJblNjZW5lRGVzY3JpcHRpb24gJiYgIXRoaXMuSXRlbS5nZXRJblNjZW5lRGVzY3JpcHRpb24oKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgQnVpbGRlckVycm9yKCdJdGVtIGNyZWF0aW9uIGNvdWxkIG5vdCBiZSBmaW5pc2hlZC4gSW5TY2VuZURlc2NyaXB0aW9uIHdhcyBub3Qgc2V0LicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuSXNDYW5Vc2VGdW5jdGlvblJlcGxhY2VkICYmICF0aGlzLkl0ZW0uZ2V0Q2Fubm90VXNlSXRlbVJlc3BvbnNlKCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEJ1aWxkZXJFcnJvcignSXRlbSBjcmVhdGlvbiBjb3VsZCBub3QgYmUgZmluaXNoZWQuIENhbm5vdFVzZUl0ZW1SZXNwb25zZSB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLkl0ZW0uZ2V0TWF4aW11bVVzYWdlcygpIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLkl0ZW0uc2V0TWF4aW11bVVzYWdlcygxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLkl0ZW0uZ2V0VXNhZ2VzTGVmdCgpIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLkl0ZW0uc2V0VXNhZ2VzTGVmdCgxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuQnVpbGRlci5hZGRJdGVtVG9CdWlsZGVyKHRoaXMuSXRlbSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuQnVpbGRlcjtcclxuICAgIH1cclxufVxyXG4iXX0=