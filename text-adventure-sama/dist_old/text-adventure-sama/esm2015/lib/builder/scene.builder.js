import { Scene } from '../models/scene.model';
import { ItemBuilder } from './item.builder';
import { BaseBuilder } from './base.builder';
import { BaseActionBuilder } from './action-builders/base-action.builder';
import { ItemYieldingAction } from '../models/actions/item-yielding-action.model';
import { BuilderError } from '../models/errors/builder.error';
import { GatewayActionBuilder } from './action-builders/gateway-action.builder';
import { ItemConsumingActionBuilder } from './action-builders/item-consuming-action.builder';
import { ItemRemovingActionBuilder } from './action-builders/item-removing-action.builder';
import { ItemYieldingActionBuilder } from './action-builders/item-yielding-action.builder';
import { MultiTimeActionBuilder } from './action-builders/multi-time-action.builder';
import { RandomResponseActionBuilder } from './action-builders/random-response-action.builder';
import { OneTimeActionBuilder } from './action-builders/one-time-action.builder';
export class SceneBuilder extends BaseBuilder {
    constructor(gameBuilder, game, sceneId = null) {
        super();
        this.GameBuilder = gameBuilder;
        this.Game = game;
        this.Scene = new Scene(sceneId);
    }
    addActionToBuilder(action) {
        this.Scene.getActions().push(action);
        if (action instanceof ItemYieldingAction) {
            this.GameBuilder.IdGeneratorService.addActionItemId(action);
        }
    }
    addAction(action) {
        return new BaseActionBuilder(this, action);
    }
    addGatewayAction() {
        return new GatewayActionBuilder(this);
    }
    addItemConsumingAction() {
        return new ItemConsumingActionBuilder(this);
    }
    addItemRemovingAction() {
        return new ItemRemovingActionBuilder(this);
    }
    addItemYieldingAction() {
        return new ItemYieldingActionBuilder(this);
    }
    addMultiTimeAction(id) {
        return new MultiTimeActionBuilder(this);
    }
    addOneTimeAction() {
        return new OneTimeActionBuilder(this);
    }
    addRandomResponseAction() {
        return new RandomResponseActionBuilder(this);
    }
    addItemToBuilder(item) {
        this.Scene.getItems().push(item);
        if (item.getID()) {
            this.GameBuilder.IdGeneratorService.addItemId(item);
        }
    }
    addItem(item) {
        return new ItemBuilder(this, item);
    }
    setName(name) {
        if (!name) {
            throw new EvalError('Name was not set.');
        }
        this.Scene.setName(name);
        return this;
    }
    setDescription(description) {
        if (!description) {
            throw new EvalError('Description was not set.');
        }
        this.Scene.setDescription(description);
        return this;
    }
    setActionNotRecognizedResponse(response) {
        if (!response) {
            throw new EvalError('ActionNotRecognizedResponse was not set.');
        }
        this.Scene.setActionNotRecognizedResponse(response);
        return this;
    }
    setItemNotFoundResponse(response) {
        if (!response) {
            throw new EvalError('ItemNotFoundResponse was not set.');
        }
        this.Scene.setItemNotFoundResponse(response);
        return this;
    }
    setInvalidInputResponse(response) {
        if (!response) {
            throw new EvalError('InvalidInputResponse was not set.');
        }
        this.Scene.setInvalidInputResponse(response);
        return this;
    }
    finish() {
        if (!this.Scene.getName()) {
            throw new BuilderError('Scene creation could not be finished. Name was not set.');
        }
        if (!this.Scene.getDescription()) {
            throw new BuilderError('Scene creation could not be finished. Description was not set.');
        }
        if (!this.Scene.getInvalidInputResponse()) {
            throw new BuilderError('Scene creation could not be finished. InvalidInputResponse was not set.');
        }
        if (!this.Scene.getItemNotFoundResponse()) {
            throw new BuilderError('Scene creation could not be finished. ItemNotFoundResponse was not set.');
        }
        if (!this.Scene.getActionNotRecognizedResponse()) {
            throw new BuilderError('Scene creation could not be finished. ActionNotRecognizedResponse was not set.');
        }
        // TODO: each scene has to have a gateway action to another scene or be the last action
        this.Game.getStage().addScene(this.Scene);
        return this.GameBuilder;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUuYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiJFOi9Eb2t1bWVudGUvUmVwb3NpdG9yaWVzL1RleHRBZHZlbnR1cmVTYW1hL3RleHQtYWR2ZW50dXJlLXNhbWEvcHJvamVjdHMvdGV4dC1hZHZlbnR1cmUtc2FtYS9zcmMvIiwic291cmNlcyI6WyJsaWIvYnVpbGRlci9zY2VuZS5idWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU5QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzdDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQzFFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM5RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNoRixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUM3RixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUMzRixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUMzRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQUNyRixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUMvRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUVqRixNQUFNLE9BQU8sWUFBYSxTQUFRLFdBQVc7SUFLekMsWUFBWSxXQUF3QixFQUFFLElBQVUsRUFBRSxVQUFrQixJQUFJO1FBQ3BFLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxD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QzVCLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdhbWVCdWlsZGVyIH0gZnJvbSAnLi9nYW1lLmJ1aWxkZXInO1xyXG5pbXBvcnQgeyBHYW1lIH0gZnJvbSAnLi4vbW9kZWxzL2dhbWUubW9kZWwnO1xyXG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gJy4uL21vZGVscy9zY2VuZS5tb2RlbCc7XHJcbmltcG9ydCB7IEluR2FtZUl0ZW0gfSBmcm9tICcuLi9tb2RlbHMvSXRlbS5tb2RlbCc7XHJcbmltcG9ydCB7IEl0ZW1CdWlsZGVyIH0gZnJvbSAnLi9pdGVtLmJ1aWxkZXInO1xyXG5pbXBvcnQgeyBJdGVtQ29udGFpbmluZ0J1aWxkZXIgfSBmcm9tICcuL2ludGVyZmFjZXMvaXRlbS1jb250YWluaW5nLmJ1aWxkZXInO1xyXG5pbXBvcnQgeyBCYXNlQnVpbGRlciB9IGZyb20gJy4vYmFzZS5idWlsZGVyJztcclxuaW1wb3J0IHsgQWN0aW9uQ29udGFpbmluZ0J1aWxkZXIgfSBmcm9tICcuL2ludGVyZmFjZXMvYWN0aW9uLWNvbnRhaW5pbmcuYnVpbGRlcic7XHJcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gJy4uL21vZGVscy9hY3Rpb25zL2FjdGlvbi5tb2RlbCc7XHJcbmltcG9ydCB7IEJhc2VBY3Rpb25CdWlsZGVyIH0gZnJvbSAnLi9hY3Rpb24tYnVpbGRlcnMvYmFzZS1hY3Rpb24uYnVpbGRlcic7XHJcbmltcG9ydCB7IEl0ZW1ZaWVsZGluZ0FjdGlvbiB9IGZyb20gJy4uL21vZGVscy9hY3Rpb25zL2l0ZW0teWllbGRpbmctYWN0aW9uLm1vZGVsJztcclxuaW1wb3J0IHsgQnVpbGRlckVycm9yIH0gZnJvbSAnLi4vbW9kZWxzL2Vycm9ycy9idWlsZGVyLmVycm9yJztcclxuaW1wb3J0IHsgR2F0ZXdheUFjdGlvbkJ1aWxkZXIgfSBmcm9tICcuL2FjdGlvbi1idWlsZGVycy9nYXRld2F5LWFjdGlvbi5idWlsZGVyJztcclxuaW1wb3J0IHsgSXRlbUNvbnN1bWluZ0FjdGlvbkJ1aWxkZXIgfSBmcm9tICcuL2FjdGlvbi1idWlsZGVycy9pdGVtLWNvbnN1bWluZy1hY3Rpb24uYnVpbGRlcic7XHJcbmltcG9ydCB7IEl0ZW1SZW1vdmluZ0FjdGlvbkJ1aWxkZXIgfSBmcm9tICcuL2FjdGlvbi1idWlsZGVycy9pdGVtLXJlbW92aW5nLWFjdGlvbi5idWlsZGVyJztcclxuaW1wb3J0IHsgSXRlbVlpZWxkaW5nQWN0aW9uQnVpbGRlciB9IGZyb20gJy4vYWN0aW9uLWJ1aWxkZXJzL2l0ZW0teWllbGRpbmctYWN0aW9uLmJ1aWxkZXInO1xyXG5pbXBvcnQgeyBNdWx0aVRpbWVBY3Rpb25CdWlsZGVyIH0gZnJvbSAnLi9hY3Rpb24tYnVpbGRlcnMvbXVsdGktdGltZS1hY3Rpb24uYnVpbGRlcic7XHJcbmltcG9ydCB7IFJhbmRvbVJlc3BvbnNlQWN0aW9uQnVpbGRlciB9IGZyb20gJy4vYWN0aW9uLWJ1aWxkZXJzL3JhbmRvbS1yZXNwb25zZS1hY3Rpb24uYnVpbGRlcic7XHJcbmltcG9ydCB7IE9uZVRpbWVBY3Rpb25CdWlsZGVyIH0gZnJvbSAnLi9hY3Rpb24tYnVpbGRlcnMvb25lLXRpbWUtYWN0aW9uLmJ1aWxkZXInO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNjZW5lQnVpbGRlciBleHRlbmRzIEJhc2VCdWlsZGVyIGltcGxlbWVudHMgSXRlbUNvbnRhaW5pbmdCdWlsZGVyLCBBY3Rpb25Db250YWluaW5nQnVpbGRlciB7XHJcbiAgICBwcml2YXRlIEdhbWVCdWlsZGVyOiBHYW1lQnVpbGRlcjtcclxuICAgIHByaXZhdGUgR2FtZTogR2FtZTtcclxuICAgIHByb3RlY3RlZCBTY2VuZTogU2NlbmU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZ2FtZUJ1aWxkZXI6IEdhbWVCdWlsZGVyLCBnYW1lOiBHYW1lLCBzY2VuZUlkOiBudW1iZXIgPSBudWxsKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICB0aGlzLkdhbWVCdWlsZGVyID0gZ2FtZUJ1aWxkZXI7XHJcbiAgICAgICAgdGhpcy5HYW1lID0gZ2FtZTtcclxuICAgICAgICB0aGlzLlNjZW5lID0gbmV3IFNjZW5lKHNjZW5lSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEFjdGlvblRvQnVpbGRlcihhY3Rpb246IEFjdGlvbik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuU2NlbmUuZ2V0QWN0aW9ucygpLnB1c2goYWN0aW9uKTtcclxuXHJcbiAgICAgICAgaWYgKGFjdGlvbiBpbnN0YW5jZW9mIEl0ZW1ZaWVsZGluZ0FjdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLkdhbWVCdWlsZGVyLklkR2VuZXJhdG9yU2VydmljZS5hZGRBY3Rpb25JdGVtSWQoYWN0aW9uIGFzIEl0ZW1ZaWVsZGluZ0FjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRBY3Rpb248VCBleHRlbmRzIEFjdGlvbj4oYWN0aW9uOiBUKTogQmFzZUFjdGlvbkJ1aWxkZXI8VCwgU2NlbmVCdWlsZGVyPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBCYXNlQWN0aW9uQnVpbGRlcjxULCBTY2VuZUJ1aWxkZXI+KHRoaXMsIGFjdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFkZEdhdGV3YXlBY3Rpb24oKTogR2F0ZXdheUFjdGlvbkJ1aWxkZXI8U2NlbmVCdWlsZGVyPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBHYXRld2F5QWN0aW9uQnVpbGRlcjxTY2VuZUJ1aWxkZXI+KHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRJdGVtQ29uc3VtaW5nQWN0aW9uKCk6IEl0ZW1Db25zdW1pbmdBY3Rpb25CdWlsZGVyPFNjZW5lQnVpbGRlcj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgSXRlbUNvbnN1bWluZ0FjdGlvbkJ1aWxkZXI8U2NlbmVCdWlsZGVyPih0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkSXRlbVJlbW92aW5nQWN0aW9uKCk6IEl0ZW1SZW1vdmluZ0FjdGlvbkJ1aWxkZXI8U2NlbmVCdWlsZGVyPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBJdGVtUmVtb3ZpbmdBY3Rpb25CdWlsZGVyPFNjZW5lQnVpbGRlcj4odGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFkZEl0ZW1ZaWVsZGluZ0FjdGlvbigpOiBJdGVtWWllbGRpbmdBY3Rpb25CdWlsZGVyPFNjZW5lQnVpbGRlcj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgSXRlbVlpZWxkaW5nQWN0aW9uQnVpbGRlcjxTY2VuZUJ1aWxkZXI+KHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRNdWx0aVRpbWVBY3Rpb24oaWQ/OiBudW1iZXIpOiBNdWx0aVRpbWVBY3Rpb25CdWlsZGVyPFNjZW5lQnVpbGRlcj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlUaW1lQWN0aW9uQnVpbGRlcjxTY2VuZUJ1aWxkZXI+KHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRPbmVUaW1lQWN0aW9uKCk6IE9uZVRpbWVBY3Rpb25CdWlsZGVyPFNjZW5lQnVpbGRlcj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgT25lVGltZUFjdGlvbkJ1aWxkZXI8U2NlbmVCdWlsZGVyPih0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkUmFuZG9tUmVzcG9uc2VBY3Rpb24oKTogUmFuZG9tUmVzcG9uc2VBY3Rpb25CdWlsZGVyPFNjZW5lQnVpbGRlcj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUmFuZG9tUmVzcG9uc2VBY3Rpb25CdWlsZGVyPFNjZW5lQnVpbGRlcj4odGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSXRlbVRvQnVpbGRlcihpdGVtOiBJbkdhbWVJdGVtKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5TY2VuZS5nZXRJdGVtcygpLnB1c2goaXRlbSk7XHJcbiAgICAgICAgaWYgKGl0ZW0uZ2V0SUQoKSkge1xyXG4gICAgICAgICAgICB0aGlzLkdhbWVCdWlsZGVyLklkR2VuZXJhdG9yU2VydmljZS5hZGRJdGVtSWQoaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRJdGVtKGl0ZW0/OiBJbkdhbWVJdGVtKTogSXRlbUJ1aWxkZXI8U2NlbmVCdWlsZGVyPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBJdGVtQnVpbGRlcjxTY2VuZUJ1aWxkZXI+KHRoaXMsIGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXROYW1lKG5hbWU6IHN0cmluZyk6IHRoaXMge1xyXG4gICAgICAgIGlmICghbmFtZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXZhbEVycm9yKCdOYW1lIHdhcyBub3Qgc2V0LicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5TY2VuZS5zZXROYW1lKG5hbWUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXREZXNjcmlwdGlvbihkZXNjcmlwdGlvbjogc3RyaW5nKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFkZXNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXZhbEVycm9yKCdEZXNjcmlwdGlvbiB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuU2NlbmUuc2V0RGVzY3JpcHRpb24oZGVzY3JpcHRpb24pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRBY3Rpb25Ob3RSZWNvZ25pemVkUmVzcG9uc2UocmVzcG9uc2U6IHN0cmluZyk6IHRoaXMge1xyXG4gICAgICAgIGlmICghcmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEV2YWxFcnJvcignQWN0aW9uTm90UmVjb2duaXplZFJlc3BvbnNlIHdhcyBub3Qgc2V0LicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5TY2VuZS5zZXRBY3Rpb25Ob3RSZWNvZ25pemVkUmVzcG9uc2UocmVzcG9uc2UpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRJdGVtTm90Rm91bmRSZXNwb25zZShyZXNwb25zZTogc3RyaW5nKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXZhbEVycm9yKCdJdGVtTm90Rm91bmRSZXNwb25zZSB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuU2NlbmUuc2V0SXRlbU5vdEZvdW5kUmVzcG9uc2UocmVzcG9uc2UpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRJbnZhbGlkSW5wdXRSZXNwb25zZShyZXNwb25zZTogc3RyaW5nKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKCFyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXZhbEVycm9yKCdJbnZhbGlkSW5wdXRSZXNwb25zZSB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuU2NlbmUuc2V0SW52YWxpZElucHV0UmVzcG9uc2UocmVzcG9uc2UpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmaW5pc2goKTogR2FtZUJ1aWxkZXIge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuU2NlbmUuZ2V0TmFtZSgpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBCdWlsZGVyRXJyb3IoJ1NjZW5lIGNyZWF0aW9uIGNvdWxkIG5vdCBiZSBmaW5pc2hlZC4gTmFtZSB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5TY2VuZS5nZXREZXNjcmlwdGlvbigpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBCdWlsZGVyRXJyb3IoJ1NjZW5lIGNyZWF0aW9uIGNvdWxkIG5vdCBiZSBmaW5pc2hlZC4gRGVzY3JpcHRpb24gd2FzIG5vdCBzZXQuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuU2NlbmUuZ2V0SW52YWxpZElucHV0UmVzcG9uc2UoKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgQnVpbGRlckVycm9yKCdTY2VuZSBjcmVhdGlvbiBjb3VsZCBub3QgYmUgZmluaXNoZWQuIEludmFsaWRJbnB1dFJlc3BvbnNlIHdhcyBub3Qgc2V0LicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLlNjZW5lLmdldEl0ZW1Ob3RGb3VuZFJlc3BvbnNlKCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEJ1aWxkZXJFcnJvcignU2NlbmUgY3JlYXRpb24gY291bGQgbm90IGJlIGZpbmlzaGVkLiBJdGVtTm90Rm91bmRSZXNwb25zZSB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5TY2VuZS5nZXRBY3Rpb25Ob3RSZWNvZ25pemVkUmVzcG9uc2UoKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgQnVpbGRlckVycm9yKCdTY2VuZSBjcmVhdGlvbiBjb3VsZCBub3QgYmUgZmluaXNoZWQuIEFjdGlvbk5vdFJlY29nbml6ZWRSZXNwb25zZSB3YXMgbm90IHNldC4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRPRE86IGVhY2ggc2NlbmUgaGFzIHRvIGhhdmUgYSBnYXRld2F5IGFjdGlvbiB0byBhbm90aGVyIHNjZW5lIG9yIGJlIHRoZSBsYXN0IGFjdGlvblxyXG5cclxuICAgICAgICB0aGlzLkdhbWUuZ2V0U3RhZ2UoKS5hZGRTY2VuZSh0aGlzLlNjZW5lKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5HYW1lQnVpbGRlcjtcclxuICAgIH1cclxufVxyXG4iXX0=